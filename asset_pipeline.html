<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Web Engineering Textbook: The Asset Pipeline</title>
  <link rel="stylesheet" type="text/css" href="stylesheets/style.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

  <link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shCore.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shThemeRailsGuides.css" />

  <link rel="stylesheet" type="text/css" href="stylesheets/fixes.css" />

  <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
</head>
<body class="guide">
  <div>
    <a href="http://github.com/backend-development/backend-development-textbook/"><img style="position: fixed; top: 0; right: 0; border: 0; z-index: 10;" src="images/forkme.png" alt="Fork me on GitHub"></a>
  </div>
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">Learn more at the sources: </strong>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="http://git-scm.com/documentation">Git Documentation</a></li>
        <li class="more-info"><a href="http://try.github.com/">Try Git</a></li>
        <li class="more-info"><a href="http://rubyonrails.org/">Ruby on Rails</a></li>
        <li class="more-info"><a href="http://guides.rubyonrails.org/">Rails Guides</a></li>
        <li class="more-info"><a href="http://railsforzombies.org/">Rails for Zombies</a></li>
        <li class="more-info"><a href="http://railscasts.com/">Railscasts</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="index.html" title="Return to home page">Backend<span> Development</span></a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">Home</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" onclick="guideMenu(); return false;" id="guidesMenu" class="guides-index-item nav-item">Index  &#x25BC;</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
              <dl class="L">
                <dt>Ruby on Rails 1</dt>
                <dd><a href="ruby_commandline.html">Ruby Commandline</a></dd>
                <dd><a href="rails_database_and_model.html">Database and Models</a></dd>
                <dd><a href="rails_view_and_controller.html">Routing, View and Controller</a></dd>
                <dd><a href="authentication_from_scratch.html">Authentication</a></dd>
                <dd><a href="asset_pipeline.html">Asset Pipeline</a></dd>
                <dd><a href="javascript_and_ajax.html">Javascript and AJAX</a></dd>
                <dd><a href="testing.html">Getting started with Testing</a></dd>
                <dd><a href="rails_gems.html">Ruby Gems for your Rails Project</a></dd>
                <dt>Ruby on Rails 2</dt>
                <dd><a href="rails_advanced_models.html">Advanced Rails Models</a></dd>
                <dd><a href="testing_with_rspec.html">Testing with RSpec</a></dd>
                <dd><a href="advanced_testing.html">Advanced testing</a></dd>
                <dd><a href="internationalization.html">Internationalization (I18n)</a></dd>
                <dd><a href="security.html">Security</a></dd>
                <dd><a href="deploying_rails.html">Deploying Rails with Capistrano</a></dd>
              </dl>
              <dl class="R">
                <dt>Git</dt>
                <dd><a href="git_basics.html">Git Basics</a></dd>
                <dd><a href="git_branching.html">Branching and Merging</a></dd>
                <dd><a href="git_teamwork.html">Teamwork</a></dd>
                <dt>Software Process</dt>
                <dd><a href="refactoring_rails.html">Refactoring Rails</a></dd>
              </dl>
          </div>
        </li>
        <li><a class="nav-item" href="https://github.com/backend-development/backend-development-textbook/">Contribute</a></li>
      </ul>
      </div>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<ol class="chapters">
<li>
<a href="#web-performance">Web Performance</a>

<ul>
<li><a href="#myths-about-performance">Myths About Performance</a></li>
<li><a href="#measuring-web-performance">Measuring Web Performance</a></li>
<li><a href="#rules">Rules...</a></li>
<li><a href="#more-rules">...more Rules...</a></li>
<li><a href="#rails-can-help">rails can help</a></li>
</ul>
</li>
<li>
<a href="#rails-environments">Rails Environments</a>

<ul>
<li><a href="#three-pre-defined-environments">Three pre-defined Environments</a></li>
<li><a href="#how-to-configure">How to Configure</a></li>
<li><a href="#how-to-use-different-environment">How to use different environment</a></li>
<li><a href="#asset-pipeline-since-rails-3">Asset Pipeline (since Rails 3)</a></li>
<li><a href="#all-git-repositories-are-created-equal-in-dignity-and-rights">all git repositories are created equal in dignity and rights</a></li>
<li><a href="#example-app-rezepte">example app 'rezepte'</a></li>
<li><a href="#remember-bang">remember!</a></li>
</ul>
</li>
<li><a href="#the-asset-pipeline">The Asset Pipeline</a></li>
<li>
<a href="#compile-to-the-web">Compile to the Web</a>

<ul>
<li><a href="#compiling-to-css">compiling to css</a></li>
<li><a href="#no-and-no">no { } and no ;</a></li>
<li><a href="#nesting">nesting</a></li>
<li><a href="#variables-and-computation">variables and computation</a></li>
<li><a href="#mixins-for-reusing-css-code">mixins for reusing css-code</a></li>
<li><a href="#automatically-create-sass-from-css-after-every-change">automatically create sass from css after every change</a></li>
<li><a href="#sass-comes-with-a-reverse-compiler">sass comes with a reverse compiler</a></li>
</ul>
</li>
<li><a href="#further-reading">Further Reading</a></li>
</ol>
</body></html>

          </div>

      <h2>The Asset Pipeline</h2><p>A web site consist of many more files than just the
HTML documents we have been generating up to now:
css files, javascript files, image files, font files, ...</p><p>The asset pipeline is rails&#39; way of preparing 
theses files for publication using the current state
of knowledge regarding web performance.</p><p>By referring to this guide, you will be able to:</p>
<ul>
<li>keep your assets in the right place</li>
<li>have all your assets compiled and minified for production</li>
</ul>
<div class="repo"><p>Fork the <a href="https://github.com/backend-development/rails-example-recipes">example app &#39;recipes&#39;</a> and try out what you learn here.</p></div>
    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<h3 id="web-performance">1 Web Performance</h3>
<p>What do we mean by 'web performance'?  From the viewpoint of one user,
the crucial value is the time it takes from requesting a page (by clicking a link
or button, or typing in an URL) to having the page displayed and interactive in your browser.
We will call this the 'response time'.</p>
<p>From the publishers point of view it might also encompass the question of
how many uses you can serve (with acceptable response time) on a given
server.  If you look at the question of how to server more users in case
of more demand you enter the realm of 'scalability'.  This is a more advanced
question that goes beyond the scope of this guide.</p>
<h4 id="myths-about-performance">1.1 Myths About Performance</h4>
<p>If you have never studied this subject you might still have
an intutation about where performance problems come from.
Many beginners are fascinated by details of their programming
language like: will using more variables make my program slower?
or: is string concatenation faster than string interpolation.</p>
<p>These 'micro optimizations' are hardly ever necssary with modern
programming languages and computers.  Using rails, postgres and any
of hundres of hosting or cloud services you will have no trouble
serving hundreds of users a day and achieving adequate performance for
all of them.</p>
<p>Trying to 'optimize' you code without having a problem at all
or without knowing which part of the system is causing the performance
problem will make your code worse, not better.</p>
<p>Donald Knuth stated this quite forcefully:</p>
<p>"The real problem is that programmers have spent far too much time worrying about efficiency in the wrong places and at the wrong times; <strong>premature optimization is the root of all evil</strong>" -- <a href="https://en.wikiquote.org/wiki/Donald_Knuth#Computer_Programming_as_an_Art_.281974.29">Donald Knuth</a></p>
<p>Only after you have measured the performance factors that are
relevant to your project, and only after you have found out
which part of the system is causing theses factors to go over
the threshold of acceptable values, only then can you truly
start to 'optimize'.  </p>
<h4 id="measuring-web-performance">1.2 Measuring Web Performance</h4>
<p>The "exceptional performance" group at yahoo published the browser addon
<code>yslow</code> in 2007. It measures performance and displays the timing
of the different HTTP connections as a "waterfall graph":</p>
<p><img src="images/network-souders-2008.png" alt="displaying http downloads with yslow"></p>
<p>(Image from Steve Souders <a href="http://www.web2expo.com/webexsf2008/public/schedule/detail/3321">talk at Web 2.0 Expo</a> in April 2008)</p>
<p>Each bar is one resource being retrieved via HTTP, the x-axis
is a common timeline for all.  The most striking result you can read from
this graph: the backend is only responsible for 5% of the time in this
example!  95% of time are spent loading and parsing javascript and css files
and loading and displaying images!</p>
<p>This graph was later integrated into the built in developer tools
of several browsers, and into the online tool <a href="https://webpagetest.org/">webpagetest</a>.</p>
<p><strong>Firefox</strong></p>
<p><img src="images/network-view-firefox.png" alt="network view in firefox"></p>
<p><strong>Chrome</strong></p>
<p><img src="images/network-view-chrome.png" alt="network view in chrom"></p>
<div class="note"><p>This guide is still a work in progress</p></div>
<h4 id="rules">1.3 Rules...</h4>
<ul>
<li>  Less HTTP Requests</li>
<li>  Use a Content Delivery Network</li>
<li>  Avoid empty src or href</li>
<li>  Add an Expires or a Cache-Control Header</li>
<li>  Gzip Components</li>
<li>  Put StyleSheets at the Top</li>
<li>  Put Scripts at the Bottom</li>
<li>  Avoid CSS Expressions...</li>
</ul>
<h4 id="more-rules">1.4 ...more Rules...</h4>
<ul>
<li>  Make JavaScript and CSS External</li>
<li>  Reduce DNS Lookups</li>
<li>  Minify JavaScript and CSS</li>
<li>  Avoid Redirects</li>
<li>  Remove Duplicate Scripts</li>
<li>  ...</li>
</ul>
<h4 id="rails-can-help">1.5 rails can help</h4>
<ul>
<li>Minify JavaScript and CSS</li>
<li>Create CSS Sprites</li>
<li>Set Expires Header for static assets</li>
</ul>
<h3 id="rails-environments">2 Rails Environments</h3>
<h4 id="three-pre-defined-environments">2.1 Three pre-defined Environments</h4>
<ul>
<li>development - optimized for debugging</li>
<li>testing</li>
<li>production - optimized for speed, stability</li>
</ul>
<h4 id="how-to-configure">2.2 How to Configure</h4>
<ul>
<li>config/environments/development.rb</li>
<li>config/environments/production.rb</li>
</ul>
<h4 id="how-to-use-different-environment">2.3 How to use different environment</h4>
<ul>
<li>webrick server: <code>rails server -e production</code>
</li>
<li>Rake tasks: add <code>RAILS_ENV="production"</code> at the end of the command.</li>
<li>Rails console: <code>rails console production</code>
</li>
</ul>
<h4 id="asset-pipeline-since-rails-3">2.4 Asset Pipeline (since Rails 3)</h4>
<ul>
<li>  source in <code>app/assets/*</code>
</li>
<li>  <code>rake assets:precompile</code>
</li>
<li>  assets in <code>public/assets/*</code>
</li>
<li>  can be served by web server, without going through the rails stack</li>
<li>  <code>public/assets/manifest.yml</code>
</li>
<li>files look like this: <code>application-107e9bb2ab22174acce34bbbbe8f6d7f.css</code>
</li>
<li>expires header is set far into the future</li>
<li>change in file --&gt; new file name</li>
</ul>
<h4 id="all-git-repositories-are-created-equal-in-dignity-and-rights">2.5 all git repositories are created equal in dignity and rights</h4>
<ul>
<li>we've been using a centralized model, pushing to a remote on repos.mediacube.at</li>
<li>today we need two working copies, but we can't push to the <code>origin</code>
</li>
<li>clone a local git repository:</li>
<li><code>git clone /path/to/the/repository new_directory_name</code></li>
<li>origin will point back to old repository</li>
<li>push and pull as usual!</li>
</ul>
<h4 id="example-app-rezepte">2.6 example app 'rezepte'</h4>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
cd /my/work
git clone ssh://repos.mediacube.at/opt/git/web_2012/example/rezepte.git/ rezepte_development
git clone /my/work/rezepte_development rezepte_production

</pre>
</div>
<h4 id="remember-bang">2.7 remember!</h4>
<p>every significant step in development should be a commit!</p>
<h3 id="the-asset-pipeline">3 The Asset Pipeline</h3>
<p><img src="images/asset-pipeline.svg" alt="Asset Pipeline"></p>
<h3 id="compile-to-the-web">4 Compile to the Web</h3>
<ul>
<li>compiling to css</li>
<li>compiling to javascript</li>
</ul>
<h4 id="compiling-to-css">4.1 compiling to css</h4>
<ul>
<li>
<a href="http://sass-lang.com/">sass</a> - default in ruby</li>
<li><a href="http://lesscss.org/">less</a></li>
<li><a href="http://learnboost.github.com/stylus/">stylus</a></li>
</ul>
<h4 id="no-and-no">4.2 no { } and no ;</h4>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
h1
  color: black
  background-color: yellow

p
  text-align: justify

</pre>
</div>
<h4 id="nesting">4.3 nesting</h4>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
h1 strong
  color: red

nav
  a:link, a:visited, a:active
    text-decoration: none
  a:link
    color: blue
  a:visited
    color: white

</pre>
</div>
<h4 id="variables-and-computation">4.4 variables and computation</h4>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
$blue: #3bbfce
$x: 16px

.content-navigation
  border-color: $blue
  color: darken($blue, 9%)

.border
  padding: $x / 2
  margin: $x / 2
  border-color: $blue

</pre>
</div>
<h4 id="mixins-for-reusing-css-code">4.5 mixins for reusing css-code</h4>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
@mixin left($dist)
  float: left
  margin-left: $dist

#data
  @include left(10px)

</pre>
</div>
<h4 id="automatically-create-sass-from-css-after-every-change">4.6 automatically create sass from css after every change</h4>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
### for one file in the current directory
sass --watch style.scss:style.css

### for a whole directory of files
sass --watch stylesheets/sass:stylesheets/compiled

</pre>
</div>
<h4 id="sass-comes-with-a-reverse-compiler">4.7 sass comes with a reverse compiler</h4>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
sass-convert --from css --to sass style.css &gt; style.sass

</pre>
</div>
<h3 id="further-reading">5 Further Reading</h3>
<ul>
<li>Souders(2007): High Performance Web Sites. O'Reilly. ISBN-13: 978-0596529307.</li>
<li>Souders(2009): Even Faster Web Sites. O'Reilly. ISBN-13: 978-0596522308.</li>
</ul>
</body></html>

      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p class="copyright">published under <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/at/deed.de">creative commons by-nc-sa</a> in 2012-2015 by <a href="http://brigitte-jellinek.at">Brigitte Jellinek</a>.
      </p><p>If you want to contribute: <a href="https://github.com/backend-development/backend-development-textbook/fork">fork the source on github</a>
        and edit <a href="https://github.com/backend-development/backend-development-textbook/blob/master/source/asset_pipeline.md">asset_pipeline.md</a>
      </p>
    </div>
  </div>

  <script type="text/javascript" src="javascripts/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/responsive-tables.js"></script>
  <script type="text/javascript" src="javascripts/guides.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shCore.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushRuby.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushXml.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushSql.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushPlain.js"></script>
  <script type="text/javascript">
    SyntaxHighlighter.all()
    $(guidesIndex.bind);
  </script>
  </body>
</html>
