<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Caching in the Backend Development Textbook</title>
  <link rel="stylesheet" type="text/css" href="stylesheets/style.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

  <link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shCore.css" />
  <link rel="stylesheet" type="text/css" href="stylesheets/syntaxhighlighter/shThemeRailsGuides.css" />

  <link rel="stylesheet" type="text/css" href="stylesheets/fixes.css" />

  <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
</head>
<body class="guide">
  <div>
    <a href="http://github.com/backend-development/backend-development-textbook/"><img style="position: fixed; top: 0; right: 0; border: 0; z-index: 10;" src="images/forkme.png" alt="Fork me on GitHub"></a>
  </div>
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">Learn more at the sources: </strong>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="http://rubyonrails.org/">Ruby on Rails</a></li>
        <li class="more-info"><a href="http://guides.rubyonrails.org/">Rails Guides</a></li>
        <li class="more-info"><a href="http://railsforzombies.org/">Rails for Zombies</a></li>
        <li class="more-info"><a href="http://curriculum.railsbridge.org/docs/">Railsbridge</a></li>
        <li class="more-info"><a href="http://railscasts.com/">Railscasts</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="index.html" title="Return to home page">Backend<span> Development</span></a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">Home</a></li>
        <li class="guides-index guides-index-large">
          <a href="index.html" onclick="guideMenu(); return false;" id="guidesMenu" class="guides-index-item nav-item">Index  &#x25BC;</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
              <dl class="L">
                <dt>Ruby on Rails</dt>
                <dd><a href="ruby_commandline.html">Ruby Commandline</a></dd>
                <dd><a href="rails_database_and_model.html">Database and Models</a></dd>
                <dd><a href="rails_view_and_controller.html">Routing, View and Controller</a></dd>
                <dd><a href="rails_authentication.html">Authentication</a></dd>
                <dd><a href="asset_pipeline.html">Asset Pipeline</a></dd>
                <dd><a href="javascript_and_ajax.html">Javascript and AJAX</a></dd>
                <dd><a href="testing.html">Getting started with Testing</a></dd>
                <dd><a href="rails_gems.html">Ruby Gems for your Rails Project</a></dd>
                <dd><a href="apis.html">APIs</a></dd>
                <dd><a href="rails_websockets.html">Websocket in Rails</a></dd>
                <dd><a href="refactoring_rails.html">Refactoring Rails</a></dd>
                <dt>Overarching Concerns</dt>
                <dd><a href="security.html">Security</a></dd>
                <dd><a href="caching.html">Caching</a></dd>
                <dd><a href="advanced_testing.html">Advanced Testing</a></dd>
                <dd><a href="internationalization.html">Internationalization (I18n)</a></dd>
              </dl>
              <dl class="R">
                <dt>Nodes.js</dt>
                <dd><a href="node_vs_rails.html">Node vs. Rails</a></dd>
                <dd><a href="node_basics.html">Node Basics</a></dd>
              </dl>
          </div>
        </li>
      </ul>
      </div>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2 id="preheader">Caching</h2>      
                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<ol class="chapters">
<li><a href="#performance">Performance</a></li>
<li>
<a href="#measuring-performance">Measuring Performance</a>

<ul>
<li><a href="#web-developer-tools-in-your-browser">Web Developer Tools in your Browser</a></li>
<li><a href="#webpagetest">Webpagetest</a></li>
<li><a href="#google-pagespeed-insights">Google PageSpeed Insights</a></li>
<li><a href="#rack-mini-profiler">rack-mini-profiler</a></li>
</ul>
</li>
<li>
<a href="#example-app">Example App</a>

<ul>
<li><a href="#caching-the-project-show-view">caching the project show view</a></li>
</ul>
</li>
<li><a href="#see-also">See Also</a></li>
</ol>
</body></html>

          </div>

      <div class="rest_header">
        <h2>Caching</h2><p>What is even better than having a really fast web
server, framework, programming language that creates
your web page?  Not having to create and load the page at all
becaus it&#39;s already there in a cache.</p><p>After working through this guide you will:</p>
<ul>
<li>be aware of many levels of caches that influence your web app</li>
<li>be able to configure rails for caching</li>
</ul>
<div class="repo"><p>You can study <a href="https://shrouded-dawn-29154.herokuapp.com/">the demo</a> for the example described here.</p></div>
      </div>
    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<h3 id="performance">1 Performance</h3>
<p>Before you start "optimizing" the performance of your web application 
you should consider these wise words:</p>
<p>"We should forget about small efficiencies, say about 97% of the time: premature optimization is the root of all evil" -- Donald Knuth</p>
<p>This is a warning against making things worst by trying to "optimize" them.
It's not an "optimization" if you make things worst. So keep these things
in the right order:</p>
<ol>
<li>Is there a performance problem? If not: stop. do not change your system. It is good enough.</li>
<li>Find out where the bottleneck is. Do this by measuring, using appropriate tools.</li>
<li>If you found the right place, only then you can start to "optimize"</li>
</ol>
<p>See Sudara(2016): <a href="http://blog.scoutapp.com/articles/2016/05/09/rails-performance-and-the-root-of-all-evil">Rails Performance and the root of all evil</a> for a more in depth
discussion.</p>
<p>Let's look at the first step: what is a "performance problem" in Web Development?
We are concerned with delivering a whole webpage to the end user. From the end users
perspective there really is only one value to measure: I clicked on something, how long
did it take for the next page to load.  We will call this the "response time".</p>
<p>At least since 2004, when Steve Souders book "High Performance Web Sites" came out
web performance has been discussed a lot in the web developer community. Measuring
tools were developed, workflows were changes, frameworks were adapted to take performance
into account. Today we can use all this knowledge and obtain results easily.  The necessary
tools are all there, we just have to use them properly.</p>
<h3 id="measuring-performance">2 Measuring Performance</h3>
<p>Let's start with a very general rule of thumb for performance:</p>
<p>We want the whole web page to load within a second.  We expect to
need about half of that (500ms) for loading extra assets like
javascript files, css, images.  We will set aside another 200ms for
shipping data across the network, which leaves us with 300ms time to
render out the first HTML document from our Rails App.</p>
<h4 id="web-developer-tools-in-your-browser">2.1 Web Developer Tools in your Browser</h4>
<p>Modern Browsers all come with extensive developer tools, which let you
analyze your webpage right in the browser.</p>
<p>An important tool is the network view:</p>
<p><img src="images/network-view-firefox.png" alt="network view firefox"></p>
<p>You can focus in on the loading of the html document itself,
and look at the timings:</p>
<p><img src="images/network-timings.png" srcset='images/network-timings.png 1x, images/network-timings@2x.png 2x' alt="network view firefox: timings"></p>
<p>Here the time "waiting" for the first byte is high.
This is a performance problem in the Rails App itself. Here
caching might help.</p>
<h4 id="webpagetest">2.2 Webpagetest</h4>
<p>Web Page Test is an open source project that you can run on your own servers.
Our you can use the online version to analyze your projects:</p>
<p><img src="images/webpagetest.png" srcset='images/webpagetest.png 1x, images/webpagetest@2x.png 2x' alt="https://www.webpagetest.org/"></p>
<p><a href="https://www.webpagetest.org/">https://www.webpagetest.org/</a></p>
<p>If the time to "first byte" is high, you have a problem when generating
the first HTML document, right in the Rails app.  Here caching might help.</p>
<h4 id="google-pagespeed-insights">2.3 Google PageSpeed Insights</h4>
<p>Google also offers a performance analysis tool, with
a separate analysis for mobile and desktop:</p>
<p><img src="images/pagespeed.png" srcset='images/pagespeed.png 1x, images/pagespeed@2x.png 2x' alt="https://developers.google.com/speed/pagespeed/insights/"></p>
<p><a href="https://developers.google.com/speed/pagespeed/insights/">https://developers.google.com/speed/pagespeed/insights/</a></p>
<h4 id="rack-mini-profiler">2.4 rack-mini-profiler</h4>
<p>This gem helps you analyze where your Rails App spends time.</p>
<p><img src="images/rack-mini-profiler.png" srcset='images/rack-mini-profiler.png 1x, images/rack-mini-profiler@2x.png 2x' alt="https://github.com/MiniProfiler/rack-mini-profiler"></p>
<p><a href="https://github.com/MiniProfiler/rack-mini-profiler">https://github.com/MiniProfiler/rack-mini-profiler</a></p>
<p>See <a href="http://railscasts.com/episodes/368-miniprofiler?view=asciicast">RailsCast #368</a> for a good introduction.</p>
<p>The Mini Profiler only measures the server side: the time spent in the rails app to generate
the webpage.  So we need to compare the numbers Mini Profiler gives us to the
300ms threshold defined above.</p>
<h3 id="example-app">3 Example App</h3>
<p>We will use a portfolio site as an example app.  All the screenshots
above already show this example app.  We will focus on the projects show action.</p>
<p>If you look at the miniprofiler above, a first glance rendering
the view takes too long: 450ms is spent there.
118ms are spent in rendering one <code>_collaborator</code> partial.  So this seems a promising
place to start optimizing.</p>
<p>Caching is deactivated by default in the development environment. 
You have to activate it if you want to try this out in development:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
#config/environments/development.rb

[...]
config.action_controller.perform_caching = true
[...]

</pre>
</div>
<p>You have to decide on a cache store, for example in-memory:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
   require 'active_support/core_ext/numeric/bytes'
   config.cache_store = :memory_store, { size: 64.megabytes }

</pre>
</div>
<h4 id="caching-the-project-show-view">3.1 caching the project show view</h4>
<p>add this around the project view:</p>
<div class="code_container">
<pre class="brush: plain; gutter: false; toolbar: false">
&lt;% cache @project do %&gt;
&lt;% end %&gt;

</pre>
</div>
<p>The result is stunning:</p>
<p><img src="images/rack-mini-profiler-faster.png" srcset='images/rack-mini-profiler-faster.png 1x, images/rack-mini-profiler-faster@2x.png 2x' alt="https://github.com/MiniProfiler/rack-mini-profiler"></p>
<p>tbc...</p>
<h3 id="see-also">4 See Also</h3>
<ul>
<li><a href="http://guides.rubyonrails.org/caching_with_rails.html">Rails Guide: Caching</a></li>
</ul>
</body></html>

      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p class="copyright">published under <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/at/deed.de">creative commons by-nc-sa</a> in 2012-2016 by <a href="http://brigitte-jellinek.at">Brigitte Jellinek</a>.
      </p><p>If you want to contribute: <a href="https://github.com/backend-development/backend-development-textbook/fork">fork the source on github</a>
        and edit <a href="https://github.com/backend-development/backend-development-textbook/blob/master/source/caching.md">caching.md</a>
      </p>
    </div>
  </div>

  <script type="text/javascript" src="javascripts/jquery.min.js"></script>
  <script type="text/javascript" src="javascripts/responsive-tables.js"></script>
  <script type="text/javascript" src="javascripts/guides.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shCore.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushRuby.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushXml.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushSql.js"></script>
  <script type="text/javascript" src="javascripts/syntaxhighlighter/shBrushPlain.js"></script>
  <script type="text/javascript">
    SyntaxHighlighter.all()
    $(guidesIndex.bind);
  </script>
  </body>
</html>
